// ==UserScript==
// @name         FZManager-Min
// @namespace    https://vex.systems/
// @version      1.0.0
// @match        https://factorio.zone/*
// @grant        unsafeWindow
// ==/UserScript==

(function(){let visitSecret=null;let sessionSecret=null;unsafeWindow.console.stdlog=unsafeWindow.console.log.bind(unsafeWindow.console);unsafeWindow.console.log=(...args)=>{for(const x of args)if(x?.visitSecret)visitSecret=x.visitSecret;unsafeWindow.console.stdlog(...args)}
setTimeout(()=>{sessionSecret=localStorage.userToken||null},2000);let customBorderEnabled=!1;let commandHintsEnabled=!0;const borderSlider=document.createElement("input");const checkmarkSVG=`<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>`;let sessionTokens=JSON.parse(localStorage.getItem("fz_session_tokens")||"[]");function saveSessionTokens(){localStorage.setItem("fz_session_tokens",JSON.stringify(sessionTokens))}
const commandList=["/help [command]","/clear","/alerts [enable | disable | mute | unmute] [alert type]","/color [color name | rgba]","/evolution","/seed","/time","/version","/players","/players online","/players count","/ignore [player name]","/ignores","/whisper [player name] [message]","/shout [message]","/mute [player name]","/unmute [player name]","/whitelist add <player name>","/whitelist remove <player name>","/whitelist get","/whitelist clear","/ban [player name] [reason]","/unban [player name]","/banlist add [player name]","/banlist remove [player name]","/banlist get","/banlist clear","/kick [player name] [reason]","/admins","/promote [player name]","/demote [player name]","/permissions","/config get [option]","/config set [option] [value]","/delete-blueprint-library [player name | everybody confirm]","/swap-players [player name] [player name]","/server-save","/save","/editor","/c <lua code>","/command <lua code>","/measured-command <lua code>","/mc <lua code>","/silent-command <lua code>","/sc <lua code>"];const translations={en:{settings:"FZManager Settings",theme:"Theme",white:"White (Default)",dark:"Dark",amoled:"AMOLED",borderRadius:"Custom border radius",commandHints:"Enable command hints",secrets:"Secrets",visitSecret:"Visit Secret",sessionSecret:"Session Secret",notAvailable:"Not available",uploadMods:"Upload Mods",selectMods:"Select Mod Files",size:"Size",uploadSelected:"Upload Selected Mods",uploading:"Uploading...",uploaded:"Uploaded ✓",failed:"Failed ✗",noModsSelected:"No mods selected",pleaseSelect:"Please select mods first",close:"Close",language:"Language",english:"English",polish:"Polish",russian:"Russian",german:"German",manageTokens:"Manage Session Tokens",tokenName:"Token Name",addToken:"Add Token",addCustomToken:"Add Custom Token",switchTo:"Switch to",delete:"Delete",currentToken:"Current Token",newToken:"New Token",addNewToken:"Add New Token",tokenAdded:"Token added",tokenSwitched:"Token switched",tokenDeleted:"Token deleted",customToken:"Custom Token",enterTokenValue:"Enter token value",resetSession:"Reset Session Secret",confirmReset:"Reset current session secret?",reset:"Reset",cancel:"Cancel",sessionReset:"Session secret reset",github:"GitHub Repository",noTokens:"No tokens saved",token:"Token"},pl:{settings:"Ustawienia FZManager",theme:"Motyw",white:"Biały (Domyślny)",dark:"Ciemny",amoled:"AMOLED",borderRadius:"Niestandardowe zaokrąglenie krawędzi",commandHints:"Włącz podpowiedzi komend",secrets:"Sekrety",visitSecret:"Sekret Wizyty",sessionSecret:"Sekret Sesji",notAvailable:"Niedostępne",uploadMods:"Załaduj Mody",selectMods:"Wybierz Pliki Modów",size:"Rozmiar",uploadSelected:"Załaduj Wybrane Mody",uploading:"Wczytywanie...",uploaded:"Wczytano ✓",failed:"Błąd ✗",noModsSelected:"Nie wybrano modów",pleaseSelect:"Najpierw wybierz mody",close:"Zamknij",language:"Język",english:"Angielski",polish:"Polski",russian:"Rosyjski",german:"Niemiecki",manageTokens:"Zarządzaj Tokenami Sesji",tokenName:"Nazwa Tokenu",addToken:"Dodaj Token",addCustomToken:"Dodaj Własny Token",switchTo:"Przełącz na",delete:"Usuń",currentToken:"Aktualny Token",newToken:"Nowy Token",addNewToken:"Dodaj Nowy Token",tokenAdded:"Token dodany",tokenSwitched:"Token przełączony",tokenDeleted:"Token usunięty",customToken:"Własny Token",enterTokenValue:"Wprowadź wartość tokenu",resetSession:"Zresetuj Sekret Sesji",confirmReset:"Zresetować aktualny sekret sesji?",reset:"Resetuj",cancel:"Anuluj",sessionReset:"Sekret sesji zresetowany",github:"Repozytorium GitHub",noTokens:"Brak zapisanych tokenów",token:"Token"},ru:{settings:"Настройки FZManager",theme:"Тема",white:"Белая (По умолчанию)",dark:"Тёмная",amoled:"AMOLED",borderRadius:"Скругление границ",commandHints:"Включить подсказки команд",secrets:"Секреты",visitSecret:"Секрет посещения",sessionSecret:"Секрет сессии",notAvailable:"Недоступно",uploadMods:"Загрузить Моды",selectMods:"Выбрать Файлы Модов",size:"Размер",uploadSelected:"Загрузить Выбранные Моды",uploading:"Загрузка...",uploaded:"Загружено ✓",failed:"Ошибка ✗",noModsSelected:"Моды не выбраны",pleaseSelect:"Сначала выберите моды",close:"Закрыть",language:"Язык",english:"Английский",polish:"Польский",russian:"Русский",german:"Немецкий",manageTokens:"Управление Токенами Сессии",tokenName:"Имя Токена",addToken:"Добавить Токен",addCustomToken:"Добавить Свой Токен",switchTo:"Переключить на",delete:"Удалить",currentToken:"Текущий Токен",newToken:"Новый Токен",addNewToken:"Добавить Новый Токен",tokenAdded:"Токен добавлен",tokenSwitched:"Токен переключен",tokenDeleted:"Токен удалён",customToken:"Свой Токен",enterTokenValue:"Введите значение токена",resetSession:"Сбросить Секрет Сессии",confirmReset:"Сбросить текущий секрет сессии?",reset:"Сбросить",cancel:"Отмена",sessionReset:"Секрет сессии сброшен",github:"Репозиторий GitHub",noTokens:"Нет сохранённых токенов",token:"Токен"},de:{settings:"FZManager Einstellungen",theme:"Thema",white:"Weiß (Standard)",dark:"Dunkel",amoled:"AMOLED",borderRadius:"Benutzerdefinierte Randabrundung",commandHints:"Befehls-Hinweise aktivieren",secrets:"Geheimnisse",visitSecret:"Besuchsgeheimnis",sessionSecret:"Sitzungsgeheimnis",notAvailable:"Nicht verfügbar",uploadMods:"Mods Hochladen",selectMods:"Mod-Dateien Auswählen",size:"Größe",uploadSelected:"Ausgewählte Mods Hochladen",uploading:"Wird hochgeladen...",uploaded:"Hochgeladen ✓",failed:"Fehlgeschlagen ✗",noModsSelected:"Keine Mods ausgewählt",pleaseSelect:"Bitte zuerst Mods auswählen",close:"Schließen",language:"Sprache",english:"Englisch",polish:"Polnisch",russian:"Russisch",german:"Deutsch",manageTokens:"Sitzungs-Token Verwalten",tokenName:"Token-Name",addToken:"Token Hinzufügen",addCustomToken:"Eigenes Token Hinzufügen",switchTo:"Wechseln zu",delete:"Löschen",currentToken:"Aktueller Token",newToken:"Neuer Token",addNewToken:"Neuen Token Hinzufügen",tokenAdded:"Token hinzugefügt",tokenSwitched:"Token gewechselt",tokenDeleted:"Token gelöscht",customToken:"Eigenes Token",enterTokenValue:"Token-Wert eingeben",resetSession:"Sitzungsgeheimnis Zurücksetzen",confirmReset:"Aktuelles Sitzungsgeheimnis zurücksetzen?",reset:"Zurücksetzen",cancel:"Abbrechen",sessionReset:"Sitzungsgeheimnis zurückgesetzt",github:"GitHub Repository",noTokens:"Keine Token gespeichert",token:"Token"}};let currentLang=localStorage.getItem("fz_language")||"en";const t=(key)=>translations[currentLang][key]||translations.en[key];function applyTheme(t){const control=document.querySelector(".control-container");const output=document.querySelector(".output-area");const socket=document.querySelector(".socket-info");const btns=document.querySelectorAll("button");const selects=document.querySelectorAll("select");const logs=document.querySelectorAll(".output-log");const arrows=document.querySelectorAll(".fre-arrow-up");const inputs=document.querySelectorAll(".input-area");const modalBox=document.querySelector("#fzmanager-modal-box");const modList=document.querySelector("#mod-upload-list");let bodyBg="#333",bodyColor="white";let socketBg="#444",outputBg="#222",logColor="white";let modalBg="rgb(41,41,41)",modalText="white";let modBg="#fff";if(t==="white"){bodyBg="#fff";bodyColor="#000";socketBg="#f2f2f2";outputBg="#f2f2f2";logColor="#000";modalBg="#fff";modalText="#000";modBg="#f2f2f2"}
if(t==="dark"){bodyBg="#333";bodyColor="#fff";socketBg="#444";outputBg="#222";logColor="#fff";modalBg="rgb(41,41,41)";modalText="#fff";modBg="#111"}
if(t==="amoled"){bodyBg="#000";bodyColor="#fff";socketBg="#111";outputBg="#000";logColor="#fff";modalBg="#000";modalText="#fff";modBg="#111"}
document.body.style.background=bodyBg;document.body.style.color=bodyColor;if(control)control.style.background=socketBg;if(output)output.style.background=outputBg;if(socket){socket.style.background=socketBg;socket.style.color=bodyColor;socket.style.borderColor=bodyColor}
btns.forEach(b=>{b.style.color=bodyColor;b.style.background="transparent";b.style.borderColor=bodyColor});selects.forEach(s=>{s.style.color=bodyColor;s.style.background=socketBg;s.style.borderColor=bodyColor});logs.forEach(l=>l.style.color=logColor);inputs.forEach(i=>{i.style.background=socketBg;i.style.color=bodyColor;i.style.borderColor=bodyColor});arrows.forEach(a=>{a.style.filter=(t!=="white")?"invert(1)":""});if(modalBox){modalBox.style.background=modalBg;modalBox.style.color=modalText}
if(modList)modList.style.background=modBg}
function overwriteOutputLog(){const observer=new MutationObserver(mutations=>{const theme=localStorage.getItem("fz_theme")||"dark";const logColor=(theme==="white")?"#000":"#fff";mutations.forEach(m=>{m.addedNodes.forEach(node=>{if(node.nodeType===1&&node.classList.contains("output-log"))node.style.color=logColor;if(node.nodeType===1)node.querySelectorAll(".output-log").forEach(c=>c.style.color=logColor);})})});observer.observe(document.body,{childList:!0,subtree:!0});const logs=document.querySelectorAll(".output-log");const theme=localStorage.getItem("fz_theme")||"dark";const logColor=(theme==="white")?"#000":"#fff";logs.forEach(l=>l.style.color=logColor)}
function styleControlButtons(radius=6){const startBtn=document.querySelector("#start-button");const stopBtn=document.querySelector("#stop-button");if(startBtn){startBtn.style.border="2px solid #28a745";startBtn.style.background="transparent";startBtn.style.color="#28a745";startBtn.style.borderRadius=radius+"px";startBtn.style.padding="6px 16px";startBtn.style.fontWeight="600";startBtn.style.transition="all 0.2s ease";startBtn.addEventListener("mouseenter",()=>{startBtn.style.background="#28a745";startBtn.style.color="#fff"});startBtn.addEventListener("mouseleave",()=>{startBtn.style.background="transparent";startBtn.style.color="#28a745"})}
if(stopBtn){stopBtn.style.border="2px solid #dc3545";stopBtn.style.background="transparent";stopBtn.style.color="#dc3545";stopBtn.style.borderRadius=radius+"px";stopBtn.style.padding="6px 16px";stopBtn.style.fontWeight="600";stopBtn.style.transition="all 0.2s ease";stopBtn.addEventListener("mouseenter",()=>{stopBtn.style.background="#dc3545";stopBtn.style.color="#fff"});stopBtn.addEventListener("mouseleave",()=>{stopBtn.style.background="transparent";stopBtn.style.color="#dc3545"})}}
function applyBorderRadius(radius){const btns=document.querySelectorAll("button");const inputs=document.querySelectorAll("input, select, .socket-info, .input-area");btns.forEach(b=>b.style.borderRadius=radius+"px");inputs.forEach(i=>i.style.borderRadius=radius+"px")}
function styleInputs(){const inputs=document.querySelectorAll(".input-area");inputs.forEach(input=>{input.placeholder="Enter a command to execute";input.style.padding="6px 10px";input.style.borderRadius=customBorderEnabled?parseInt(borderSlider.value)+"px":"6px";input.style.border="1px solid var(--background-div-border)";input.style.background="var(--background-div-color)";input.style.color="inherit";input.style.transition="all 0.2s ease";input.addEventListener("focus",()=>{input.style.borderColor="#666";input.style.boxShadow="0 0 5px rgba(100, 100, 100, 0.3)"});input.addEventListener("blur",()=>{input.style.borderColor="var(--background-div-border)";input.style.boxShadow="none"})})}
function setupCommandHints(){const input=document.querySelector(".input-area");if(!input)return;let hintBox=document.createElement("div");input.parentNode.insertBefore(hintBox,input);hintBox.style.marginBottom="4px";hintBox.style.background="rgba(0,0,0,0.85)";hintBox.style.color="white";hintBox.style.padding="6px 10px";hintBox.style.borderRadius="6px";hintBox.style.fontSize="14px";hintBox.style.display="none";hintBox.style.transition="all 0.2s ease";input.addEventListener("input",()=>{if(!commandHintsEnabled||input.value.trim()===""){hintBox.style.display="none";return}
const match=commandList.find(c=>c.startsWith(input.value));if(match){hintBox.textContent=match;hintBox.style.display="block";hintBox.style.opacity="0";setTimeout(()=>hintBox.style.opacity="1",10)}else{hintBox.style.display="none"}})}
function createStyledCheckbox(id,labelText,checked=!1,onChange){const container=document.createElement("div");container.style.display="flex";container.style.alignItems="center";container.style.gap="8px";container.style.cursor="pointer";container.style.userSelect="none";const checkbox=document.createElement("input");checkbox.type="checkbox";checkbox.id=id;checkbox.checked=checked;checkbox.style.display="none";const customCheckbox=document.createElement("div");customCheckbox.style.width="18px";customCheckbox.style.height="18px";customCheckbox.style.borderRadius="4px";customCheckbox.style.border="2px solid #666";customCheckbox.style.position="relative";customCheckbox.style.transition="all 0.2s ease";customCheckbox.style.display="flex";customCheckbox.style.alignItems="center";customCheckbox.style.justifyContent="center";const checkmark=document.createElement("div");checkmark.innerHTML=checkmarkSVG;checkmark.style.opacity=checked?"1":"0";checkmark.style.transform=checked?"scale(1)":"scale(0)";checkmark.style.transition="all 0.2s ease";checkmark.style.color="white";customCheckbox.appendChild(checkmark);const label=document.createElement("label");label.htmlFor=id;label.textContent=labelText;label.style.fontSize="13px";label.style.opacity="0.9";label.style.cursor="pointer";customCheckbox.addEventListener("click",()=>{checkbox.checked=!checkbox.checked;customCheckbox.style.background=checkbox.checked?"#666":"transparent";customCheckbox.style.borderColor=checkbox.checked?"#666":"#666";checkmark.style.opacity=checkbox.checked?"1":"0";checkmark.style.transform=checkbox.checked?"scale(1)":"scale(0)";if(onChange)onChange(checkbox.checked);});customCheckbox.style.background=checked?"#666":"transparent";customCheckbox.style.borderColor=checked?"#666":"#666";container.appendChild(checkbox);container.appendChild(customCheckbox);container.appendChild(label);checkbox.addEventListener("change",()=>{customCheckbox.style.background=checkbox.checked?"#666":"transparent";customCheckbox.style.borderColor=checkbox.checked?"#666":"#666";checkmark.style.opacity=checkbox.checked?"1":"0";checkmark.style.transform=checkbox.checked?"scale(1)":"scale(0)";if(onChange)onChange(checkbox.checked);});return{container,checkbox}}
function createStyledSlider(id,min,max,value,onChange){const container=document.createElement("div");container.style.display="flex";container.style.flexDirection="column";container.style.gap="6px";container.style.width="100%";const slider=document.createElement("input");slider.type="range";slider.id=id;slider.min=min;slider.max=max;slider.value=value;slider.style.width="100%";slider.style.height="5px";slider.style.appearance="none";slider.style.background="rgba(100, 100, 100, 0.2)";slider.style.borderRadius="10px";slider.style.outline="none";slider.style.opacity="1";slider.style.transition="all 0.2s ease";const percent=((value-min)/(max-min))*100;slider.style.background=`linear-gradient(to right, #666 0%, #666 ${percent}%, rgba(100, 100, 100, 0.2) ${percent}%, rgba(100, 100, 100, 0.2) 100%)`;slider.addEventListener("input",()=>{const percent=((slider.value-min)/(max-min))*100;slider.style.background=`linear-gradient(to right, #666 0%, #666 ${percent}%, rgba(100, 100, 100, 0.2) ${percent}%, rgba(100, 100, 100, 0.2) 100%)`;if(onChange)onChange(slider.value);});const style=document.createElement("style");style.textContent=`
        #${id}::-webkit-slider-thumb {
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #666;
            border: 2px solid rgba(255,255,255,0.8);
            cursor: pointer;
            box-shadow: 0 0 4px rgba(0,0,0,0.3);
            transition: all 0.2s ease;
        }

        #${id}::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 0 6px rgba(0,0,0,0.4);
        }

        #${id}::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #666;
            border: 2px solid rgba(255,255,255,0.8);
            cursor: pointer;
            box-shadow: 0 0 4px rgba(0,0,0,0.3);
            transition: all 0.2s ease;
        }

        #${id}::-moz-range-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 0 6px rgba(0,0,0,0.4);
        }
    `;document.head.appendChild(style);container.appendChild(slider);return{container,slider}}
function createStyledSelect(id,options,value,onChange){const container=document.createElement("div");container.style.position="relative";container.style.width="100%";const select=document.createElement("select");select.id=id;select.style.width="100%";select.style.padding="6px 30px 6px 8px";select.style.borderRadius="6px";select.style.border="1px solid #666";select.style.background="rgba(100, 100, 100, 0.1)";select.style.color="inherit";select.style.fontSize="13px";select.style.appearance="none";select.style.cursor="pointer";select.style.transition="all 0.2s ease";select.style.outline="none";options.forEach(opt=>{const option=document.createElement("option");option.value=opt.value;option.textContent=opt.label;select.appendChild(option)});select.value=value;const arrow=document.createElement("div");arrow.innerHTML="▼";arrow.style.position="absolute";arrow.style.right="8px";arrow.style.top="50%";arrow.style.transform="translateY(-50%)";arrow.style.pointerEvents="none";arrow.style.color="#666";arrow.style.fontSize="10px";select.addEventListener("change",()=>{if(onChange)onChange(select.value);});select.addEventListener("focus",()=>{select.style.borderColor="#888";select.style.boxShadow="0 0 0 2px rgba(100, 100, 100, 0.1)"});select.addEventListener("blur",()=>{select.style.borderColor="#666";select.style.boxShadow="none"});container.appendChild(select);container.appendChild(arrow);return{container,select}}
function showNotification(message,type="info"){const notification=document.createElement("div");notification.textContent=message;notification.style.position="fixed";notification.style.top="20px";notification.style.right="20px";notification.style.background=type==="success"?"rgba(40, 167, 69, 0.9)":type==="error"?"rgba(220, 53, 69, 0.9)":"rgba(100, 100, 100, 0.9)";notification.style.color="white";notification.style.padding="10px 16px";notification.style.borderRadius="6px";notification.style.zIndex="1000000";notification.style.fontSize="13px";notification.style.boxShadow="0 4px 12px rgba(0,0,0,0.3)";notification.style.opacity="0";notification.style.transform="translateX(20px)";notification.style.transition="all 0.3s ease";document.body.appendChild(notification);setTimeout(()=>{notification.style.opacity="1";notification.style.transform="translateX(0)"},10);setTimeout(()=>{notification.style.opacity="0";notification.style.transform="translateX(20px)";setTimeout(()=>notification.remove(),300)},3000)}
function updateTranslations(){const elements=document.querySelectorAll("[data-translate]");elements.forEach(el=>{const key=el.getAttribute("data-translate");if(translations[currentLang][key]){el.textContent=translations[currentLang][key]}})}
function reloadScript(){location.reload()}
function showResetSessionModal(){const modal=document.createElement("div");modal.style.position="fixed";modal.style.inset="0";modal.style.background="rgba(0,0,0,0.5)";modal.style.backdropFilter="blur(4px)";modal.style.display="flex";modal.style.alignItems="center";modal.style.justifyContent="center";modal.style.zIndex="1000001";modal.style.opacity="0";modal.style.transition="opacity 0.3s ease";const box=document.createElement("div");box.style.background=localStorage.getItem("fz_theme")==="white"?"#fff":"#333";box.style.color=localStorage.getItem("fz_theme")==="white"?"#000":"#fff";box.style.padding="20px";box.style.borderRadius="10px";box.style.minWidth="300px";box.style.boxShadow="0 10px 30px rgba(0,0,0,0.3)";box.style.transform="scale(0.9)";box.style.transition="transform 0.3s ease";const title=document.createElement("div");title.textContent=t("resetSession");title.style.fontSize="16px";title.style.fontWeight="600";title.style.marginBottom="15px";const message=document.createElement("div");message.textContent=t("confirmReset");message.style.fontSize="14px";message.style.opacity="0.8";message.style.marginBottom="20px";const buttons=document.createElement("div");buttons.style.display="flex";buttons.style.justifyContent="flex-end";buttons.style.gap="10px";const cancelBtn=document.createElement("button");cancelBtn.textContent=t("cancel");cancelBtn.style.padding="8px 16px";cancelBtn.style.borderRadius="6px";cancelBtn.style.border="1px solid #666";cancelBtn.style.background="transparent";cancelBtn.style.color="inherit";cancelBtn.style.cursor="pointer";cancelBtn.style.transition="all 0.2s ease";const resetBtn=document.createElement("button");resetBtn.textContent=t("reset");resetBtn.style.padding="8px 16px";resetBtn.style.borderRadius="6px";resetBtn.style.border="1px solid #dc3545";resetBtn.style.background="rgba(220, 53, 69, 0.1)";resetBtn.style.color="#dc3545";resetBtn.style.cursor="pointer";resetBtn.style.transition="all 0.2s ease";cancelBtn.addEventListener("mouseenter",()=>{cancelBtn.style.background="rgba(100, 100, 100, 0.1)"});cancelBtn.addEventListener("mouseleave",()=>{cancelBtn.style.background="transparent"});resetBtn.addEventListener("mouseenter",()=>{resetBtn.style.background="rgba(220, 53, 69, 0.2)"});resetBtn.addEventListener("mouseleave",()=>{resetBtn.style.background="rgba(220, 53, 69, 0.1)"});cancelBtn.addEventListener("click",()=>{modal.style.opacity="0";box.style.transform="scale(0.9)";setTimeout(()=>modal.remove(),300)});resetBtn.addEventListener("click",()=>{delete localStorage.userToken;sessionSecret=null;showNotification(t("sessionReset"),"success");setTimeout(()=>location.reload(),500)});buttons.appendChild(cancelBtn);buttons.appendChild(resetBtn);box.appendChild(title);box.appendChild(message);box.appendChild(buttons);modal.appendChild(box);document.body.appendChild(modal);setTimeout(()=>{modal.style.opacity="1";box.style.transform="scale(1)"},10);return modal}
function createSettings(){const target=document.querySelector(".fre-info.fre-bottom");if(!target)return;target.appendChild(document.createElement("br"));const btn=document.createElement("button");btn.textContent=t("settings");btn.style.padding="6px 12px";btn.style.borderRadius="6px";btn.style.border="1px solid #666";btn.style.background="rgba(100, 100, 100, 0.1)";btn.style.color="inherit";btn.style.cursor="pointer";btn.style.marginTop="8px";btn.style.fontSize="13px";btn.setAttribute("data-translate","settings");target.appendChild(btn);const modal=document.createElement("div");modal.id="fzmanager-modal";modal.style.position="fixed";modal.style.inset="0";modal.style.background="rgba(0,0,0,0.55)";modal.style.backdropFilter="blur(4px)";modal.style.display="none";modal.style.alignItems="center";modal.style.justifyContent="center";modal.style.zIndex="999999";modal.style.opacity="0";modal.style.transition="opacity 0.25s ease";const box=document.createElement("div");box.id="fzmanager-modal-box";box.style.borderRadius="10px";box.style.padding="18px";box.style.minWidth="480px";box.style.width="max-content";box.style.maxWidth="90vw";box.style.display="flex";box.style.flexDirection="column";box.style.gap="14px";box.style.transform="scale(0.95)";box.style.transition="transform 0.25s ease";const title=document.createElement("div");title.textContent=t("settings");title.style.fontSize="18px";title.style.fontWeight="700";title.style.marginBottom="4px";title.style.textAlign="center";title.setAttribute("data-translate","settings");const mainContainer=document.createElement("div");mainContainer.style.display="grid";mainContainer.style.gridTemplateColumns="1fr 1fr";mainContainer.style.gap="20px";mainContainer.style.marginTop="6px";const leftColumn=document.createElement("div");leftColumn.style.display="flex";leftColumn.style.flexDirection="column";leftColumn.style.gap="14px";const secTitle=document.createElement("div");secTitle.textContent=t("secrets");secTitle.style.fontSize="15px";secTitle.style.fontWeight="600";secTitle.style.textAlign="left";secTitle.style.borderBottom="1px solid #666";secTitle.style.paddingBottom="6px";secTitle.setAttribute("data-translate","secrets");const secretBox=document.createElement("div");secretBox.style.display="flex";secretBox.style.flexDirection="column";secretBox.style.gap="10px";function makeBlurField(labelKey,getter,showAction=!1){const wrap=document.createElement("div");wrap.style.display="flex";wrap.style.flexDirection="column";wrap.style.gap="4px";const header=document.createElement("div");header.style.display="flex";header.style.justifyContent="space-between";header.style.alignItems="center";const l=document.createElement("div");l.textContent=t(labelKey);l.style.fontSize="13px";l.style.opacity="0.9";l.setAttribute("data-translate",labelKey);header.appendChild(l);if(showAction&&labelKey==="sessionSecret"){const resetBtn=document.createElement("button");resetBtn.textContent=t("resetSession");resetBtn.style.padding="4px 8px";resetBtn.style.borderRadius="4px";resetBtn.style.border="1px solid #dc3545";resetBtn.style.background="rgba(220, 53, 69, 0.1)";resetBtn.style.color="#dc3545";resetBtn.style.cursor="pointer";resetBtn.style.fontSize="11px";resetBtn.style.transition="all 0.2s ease";resetBtn.setAttribute("data-translate","resetSession");resetBtn.addEventListener("mouseenter",()=>{resetBtn.style.background="rgba(220, 53, 69, 0.2)"});resetBtn.addEventListener("mouseleave",()=>{resetBtn.style.background="rgba(220, 53, 69, 0.1)"});resetBtn.addEventListener("click",showResetSessionModal);header.appendChild(resetBtn)}
const v=document.createElement("div");v.style.padding="6px 8px";v.style.borderRadius="6px";v.style.border="1px solid #666";v.style.background="rgba(100, 100, 100, 0.1)";v.style.filter="blur(6px)";v.style.transition="all 0.2s ease";v.style.cursor="pointer";v.style.whiteSpace="nowrap";v.style.overflow="hidden";v.style.textOverflow="ellipsis";v.style.fontFamily="monospace";v.style.fontSize="12px";v.style.minHeight="32px";v.style.display="flex";v.style.alignItems="center";v.addEventListener("mouseenter",()=>{v.style.filter="blur(0px)";v.style.background="rgba(100, 100, 100, 0.15)";v.style.borderColor="#888"});v.addEventListener("mouseleave",()=>{v.style.filter="blur(6px)";v.style.background="rgba(100, 100, 100, 0.1)";v.style.borderColor="#666"});setInterval(()=>v.textContent=getter()||t("notAvailable"),500);wrap.appendChild(header);wrap.appendChild(v);return wrap}
secretBox.appendChild(makeBlurField("visitSecret",()=>visitSecret));secretBox.appendChild(makeBlurField("sessionSecret",()=>sessionSecret,!0));const tokenTitle=document.createElement("div");tokenTitle.textContent=t("manageTokens");tokenTitle.style.fontSize="15px";tokenTitle.style.fontWeight="600";tokenTitle.style.textAlign="left";tokenTitle.style.borderBottom="1px solid #666";tokenTitle.style.paddingBottom="6px";tokenTitle.style.marginTop="8px";tokenTitle.setAttribute("data-translate","manageTokens");const tokenList=document.createElement("div");tokenList.id="token-list";tokenList.style.maxHeight="150px";tokenList.style.overflowY="auto";tokenList.style.border="1px solid #666";tokenList.style.borderRadius="6px";tokenList.style.padding="8px";tokenList.style.display="flex";tokenList.style.flexDirection="column";tokenList.style.gap="6px";const addTokenForm=document.createElement("div");addTokenForm.style.display="flex";addTokenForm.style.flexDirection="column";addTokenForm.style.gap="6px";addTokenForm.style.marginTop="8px";const tokenTabs=document.createElement("div");tokenTabs.style.display="flex";tokenTabs.style.gap="4px";tokenTabs.style.marginBottom="6px";const currentTokenTab=document.createElement("button");currentTokenTab.textContent=t("currentToken");currentTokenTab.style.padding="6px 10px";currentTokenTab.style.borderRadius="4px";currentTokenTab.style.border="1px solid #666";currentTokenTab.style.background="rgba(100, 100, 100, 0.15)";currentTokenTab.style.color="inherit";currentTokenTab.style.cursor="pointer";currentTokenTab.style.fontSize="12px";currentTokenTab.style.flex="1";currentTokenTab.setAttribute("data-translate","currentToken");const customTokenTab=document.createElement("button");customTokenTab.textContent=t("customToken");customTokenTab.style.padding="6px 10px";customTokenTab.style.borderRadius="4px";customTokenTab.style.border="1px solid #666";customTokenTab.style.background="rgba(100, 100, 100, 0.1)";customTokenTab.style.color="inherit";customTokenTab.style.cursor="pointer";customTokenTab.style.fontSize="12px";customTokenTab.style.flex="1";customTokenTab.setAttribute("data-translate","customToken");tokenTabs.appendChild(currentTokenTab);tokenTabs.appendChild(customTokenTab);const currentTokenForm=document.createElement("div");currentTokenForm.style.display="flex";currentTokenForm.style.gap="6px";const tokenNameInput=document.createElement("input");tokenNameInput.type="text";tokenNameInput.placeholder=t("tokenName");tokenNameInput.style.flex="1";tokenNameInput.style.padding="6px 8px";tokenNameInput.style.borderRadius="6px";tokenNameInput.style.border="1px solid #666";tokenNameInput.style.background="rgba(100, 100, 100, 0.1)";tokenNameInput.style.color="inherit";tokenNameInput.style.fontSize="12px";tokenNameInput.style.outline="none";tokenNameInput.setAttribute("data-translate-placeholder","tokenName");const addTokenBtn=document.createElement("button");addTokenBtn.textContent=t("addToken");addTokenBtn.style.padding="6px 12px";addTokenBtn.style.borderRadius="6px";addTokenBtn.style.border="1px solid #666";addTokenBtn.style.background="rgba(100, 100, 100, 0.1)";addTokenBtn.style.color="inherit";addTokenBtn.style.cursor="pointer";addTokenBtn.style.fontSize="12px";addTokenBtn.style.transition="all 0.2s ease";addTokenBtn.setAttribute("data-translate","addToken");const customTokenForm=document.createElement("div");customTokenForm.style.display="none";customTokenForm.style.flexDirection="column";customTokenForm.style.gap="6px";const customTokenNameInput=document.createElement("input");customTokenNameInput.type="text";customTokenNameInput.placeholder=t("tokenName");customTokenNameInput.style.padding="6px 8px";customTokenNameInput.style.borderRadius="6px";customTokenNameInput.style.border="1px solid #666";customTokenNameInput.style.background="rgba(100, 100, 100, 0.1)";customTokenNameInput.style.color="inherit";customTokenNameInput.style.fontSize="12px";customTokenNameInput.style.outline="none";customTokenNameInput.setAttribute("data-translate-placeholder","tokenName");const customTokenValueInput=document.createElement("input");customTokenValueInput.type="text";customTokenValueInput.placeholder=t("enterTokenValue");customTokenValueInput.style.padding="6px 8px";customTokenValueInput.style.borderRadius="6px";customTokenValueInput.style.border="1px solid #666";customTokenValueInput.style.background="rgba(100, 100, 100, 0.1)";customTokenValueInput.style.color="inherit";customTokenValueInput.style.fontSize="12px";customTokenValueInput.style.outline="none";customTokenValueInput.setAttribute("data-translate-placeholder","enterTokenValue");const addCustomTokenBtn=document.createElement("button");addCustomTokenBtn.textContent=t("addCustomToken");addCustomTokenBtn.style.padding="6px 12px";addCustomTokenBtn.style.borderRadius="6px";addCustomTokenBtn.style.border="1px solid #666";addCustomTokenBtn.style.background="rgba(100, 100, 100, 0.1)";addCustomTokenBtn.style.color="inherit";addCustomTokenBtn.style.cursor="pointer";addCustomTokenBtn.style.fontSize="12px";addCustomTokenBtn.style.transition="all 0.2s ease";addCustomTokenBtn.setAttribute("data-translate","addCustomToken");let currentTab="current";currentTokenTab.addEventListener("click",()=>{currentTab="current";currentTokenTab.style.background="rgba(100, 100, 100, 0.15)";customTokenTab.style.background="rgba(100, 100, 100, 0.1)";currentTokenForm.style.display="flex";customTokenForm.style.display="none"});customTokenTab.addEventListener("click",()=>{currentTab="custom";currentTokenTab.style.background="rgba(100, 100, 100, 0.1)";customTokenTab.style.background="rgba(100, 100, 100, 0.15)";currentTokenForm.style.display="none";customTokenForm.style.display="flex"});addTokenBtn.addEventListener("mouseenter",()=>{addTokenBtn.style.background="rgba(100, 100, 100, 0.2)";addTokenBtn.style.borderColor="#888"});addTokenBtn.addEventListener("mouseleave",()=>{addTokenBtn.style.background="rgba(100, 100, 100, 0.1)";addTokenBtn.style.borderColor="#666"});addCustomTokenBtn.addEventListener("mouseenter",()=>{addCustomTokenBtn.style.background="rgba(100, 100, 100, 0.2)";addCustomTokenBtn.style.borderColor="#888"});addCustomTokenBtn.addEventListener("mouseleave",()=>{addCustomTokenBtn.style.background="rgba(100, 100, 100, 0.1)";addCustomTokenBtn.style.borderColor="#666"});currentTokenForm.appendChild(tokenNameInput);currentTokenForm.appendChild(addTokenBtn);customTokenForm.appendChild(customTokenNameInput);customTokenForm.appendChild(customTokenValueInput);customTokenForm.appendChild(addCustomTokenBtn);addTokenForm.appendChild(tokenTabs);addTokenForm.appendChild(currentTokenForm);addTokenForm.appendChild(customTokenForm);leftColumn.appendChild(secTitle);leftColumn.appendChild(secretBox);leftColumn.appendChild(tokenTitle);leftColumn.appendChild(tokenList);leftColumn.appendChild(addTokenForm);const rightColumn=document.createElement("div");rightColumn.style.display="flex";rightColumn.style.flexDirection="column";rightColumn.style.gap="16px";const settingsBlock=document.createElement("div");settingsBlock.style.display="flex";settingsBlock.style.flexDirection="column";settingsBlock.style.gap="12px";const settingsTitle=document.createElement("div");settingsTitle.textContent="Settings";settingsTitle.style.fontSize="15px";settingsTitle.style.fontWeight="600";settingsTitle.style.textAlign="left";settingsTitle.style.borderBottom="1px solid #666";settingsTitle.style.paddingBottom="6px";const languageGroup=document.createElement("div");languageGroup.style.display="flex";languageGroup.style.flexDirection="column";languageGroup.style.gap="4px";const languageLabel=document.createElement("div");languageLabel.textContent=t("language");languageLabel.style.fontSize="13px";languageLabel.style.opacity="0.9";languageLabel.setAttribute("data-translate","language");const languageSelect=createStyledSelect("language-select",[{value:"en",label:t("english")},{value:"pl",label:t("polish")},{value:"ru",label:t("russian")},{value:"de",label:t("german")}],currentLang,(value)=>{currentLang=value;localStorage.setItem("fz_language",value);setTimeout(reloadScript,300)});languageGroup.appendChild(languageLabel);languageGroup.appendChild(languageSelect.container);const themeGroup=document.createElement("div");themeGroup.style.display="flex";themeGroup.style.flexDirection="column";themeGroup.style.gap="4px";const themeLabel=document.createElement("div");themeLabel.textContent=t("theme");themeLabel.style.fontSize="13px";themeLabel.style.opacity="0.9";themeLabel.setAttribute("data-translate","theme");const themeSelect=createStyledSelect("theme-select",[{value:"white",label:t("white")},{value:"dark",label:t("dark")},{value:"amoled",label:t("amoled")}],localStorage.getItem("fz_theme")||"dark",(value)=>{localStorage.setItem("fz_theme",value);location.reload()});themeGroup.appendChild(themeLabel);themeGroup.appendChild(themeSelect.container);const borderGroup=document.createElement("div");borderGroup.style.display="flex";borderGroup.style.flexDirection="column";borderGroup.style.gap="8px";const borderCheckbox=createStyledCheckbox("border-checkbox",t("borderRadius"),customBorderEnabled,(checked)=>{customBorderEnabled=checked;borderSlider.slider.disabled=!customBorderEnabled;borderSlider.slider.style.opacity=customBorderEnabled?"1":"0.5";if(customBorderEnabled){applyBorderRadius(parseInt(borderSlider.slider.value));styleInputs()}else{applyBorderRadius(6);styleInputs()}});const borderSliderElement=createStyledSlider("border-slider",0,50,6,(value)=>{if(customBorderEnabled){applyBorderRadius(parseInt(value));styleInputs()}});borderGroup.appendChild(borderCheckbox.container);borderGroup.appendChild(borderSliderElement.container);const hintCheckbox=createStyledCheckbox("hint-checkbox",t("commandHints"),commandHintsEnabled,(checked)=>{commandHintsEnabled=checked});const modSection=document.createElement("div");modSection.style.display="flex";modSection.style.flexDirection="column";modSection.style.gap="10px";modSection.style.marginTop="4px";const modTitle=document.createElement("div");modTitle.textContent=t("uploadMods");modTitle.style.fontSize="15px";modTitle.style.fontWeight="600";modTitle.style.textAlign="left";modTitle.style.borderBottom="1px solid #666";modTitle.style.paddingBottom="6px";modTitle.setAttribute("data-translate","uploadMods");const modInput=document.createElement("input");modInput.type="file";modInput.multiple=!0;modInput.accept=".zip";modInput.style.padding="6px 8px";modInput.style.borderRadius="6px";modInput.style.border="1px solid #666";modInput.style.background="rgba(100, 100, 100, 0.1)";modInput.style.color="inherit";modInput.style.cursor="pointer";modInput.style.fontSize="12px";modInput.style.transition="all 0.2s ease";modInput.addEventListener("focus",()=>{modInput.style.borderColor="#888";modInput.style.boxShadow="0 0 0 2px rgba(100, 100, 100, 0.1)"});modInput.addEventListener("blur",()=>{modInput.style.borderColor="#666";modInput.style.boxShadow="none"});const modList=document.createElement("div");modList.id="mod-upload-list";modList.style.maxHeight="120px";modList.style.overflowY="auto";modList.style.border="1px solid #666";modList.style.borderRadius="6px";modList.style.padding="6px";modList.style.display="flex";modList.style.flexDirection="column";modList.style.gap="4px";const uploadBtn=document.createElement("button");uploadBtn.textContent=t("uploadSelected");uploadBtn.style.padding="6px 12px";uploadBtn.style.borderRadius="6px";uploadBtn.style.border="1px solid #666";uploadBtn.style.background="rgba(100, 100, 100, 0.1)";uploadBtn.style.color="inherit";uploadBtn.style.fontWeight="500";uploadBtn.style.cursor="pointer";uploadBtn.style.transition="all 0.2s ease";uploadBtn.style.marginTop="4px";uploadBtn.style.fontSize="13px";uploadBtn.setAttribute("data-translate","uploadSelected");uploadBtn.addEventListener("mouseenter",()=>{uploadBtn.style.background="rgba(100, 100, 100, 0.2)";uploadBtn.style.borderColor="#888"});uploadBtn.addEventListener("mouseleave",()=>{uploadBtn.style.background="rgba(100, 100, 100, 0.1)";uploadBtn.style.borderColor="#666"});settingsBlock.appendChild(languageGroup);settingsBlock.appendChild(themeGroup);settingsBlock.appendChild(borderGroup);settingsBlock.appendChild(hintCheckbox.container);modSection.appendChild(modTitle);modSection.appendChild(modInput);modSection.appendChild(modList);modSection.appendChild(uploadBtn);rightColumn.appendChild(settingsBlock);rightColumn.appendChild(modSection);mainContainer.appendChild(leftColumn);mainContainer.appendChild(rightColumn);const footer=document.createElement("div");footer.style.display="flex";footer.style.justifyContent="space-between";footer.style.alignItems="center";footer.style.marginTop="12px";footer.style.borderTop="1px solid #666";footer.style.paddingTop="10px";const githubFooterLink=document.createElement("p");githubFooterLink.target="_blank";githubFooterLink.innerHTML="github.com/l1806-vex/FZManager"
githubFooterLink.style.display="inline-block";githubFooterLink.style.marginRight="10px";githubFooterLink.style.textDecoration="none";const closeBtn=document.createElement("button");closeBtn.textContent=t("close");closeBtn.style.padding="6px 16px";closeBtn.style.borderRadius="6px";closeBtn.style.border="1px solid #666";closeBtn.style.background="rgba(100, 100, 100, 0.1)";closeBtn.style.color="inherit";closeBtn.style.cursor="pointer";closeBtn.style.transition="all 0.2s ease";closeBtn.style.fontWeight="500";closeBtn.style.fontSize="13px";closeBtn.setAttribute("data-translate","close");closeBtn.addEventListener("mouseenter",()=>{closeBtn.style.background="rgba(100, 100, 100, 0.2)";closeBtn.style.borderColor="#888"});closeBtn.addEventListener("mouseleave",()=>{closeBtn.style.background="rgba(100, 100, 100, 0.1)";closeBtn.style.borderColor="#666"});footer.appendChild(githubFooterLink);footer.appendChild(closeBtn);box.appendChild(title);box.appendChild(mainContainer);box.appendChild(footer);modal.appendChild(box);document.body.appendChild(modal);function updateTokenList(){tokenList.innerHTML="";if(sessionTokens.length===0){const emptyMsg=document.createElement("div");emptyMsg.textContent=t("noTokens");emptyMsg.style.opacity="0.6";emptyMsg.style.textAlign="center";emptyMsg.style.padding="8px";tokenList.appendChild(emptyMsg);return}
sessionTokens.forEach((token,index)=>{const tokenDiv=document.createElement("div");tokenDiv.style.display="flex";tokenDiv.style.justifyContent="space-between";tokenDiv.style.alignItems="center";tokenDiv.style.padding="6px 8px";tokenDiv.style.borderRadius="4px";tokenDiv.style.border="1px solid #666";tokenDiv.style.background="rgba(100, 100, 100, 0.05)";tokenDiv.style.marginBottom="4px";const tokenInfo=document.createElement("div");tokenInfo.style.display="flex";tokenInfo.style.flexDirection="column";tokenInfo.style.gap="2px";const tokenName=document.createElement("div");tokenName.textContent=token.name||`${t("token")} ${index + 1}`;tokenName.style.fontSize="12px";tokenName.style.fontWeight="500";const tokenValue=document.createElement("div");tokenValue.textContent=token.value.substring(0,12)+"...";tokenValue.style.fontSize="10px";tokenValue.style.opacity="0.7";tokenValue.style.fontFamily="monospace";tokenInfo.appendChild(tokenName);tokenInfo.appendChild(tokenValue);const tokenActions=document.createElement("div");tokenActions.style.display="flex";tokenActions.style.gap="4px";const switchBtn=document.createElement("button");switchBtn.textContent=t("switchTo");switchBtn.style.padding="3px 6px";switchBtn.style.borderRadius="4px";switchBtn.style.border="1px solid #666";switchBtn.style.background="rgba(100, 100, 100, 0.1)";switchBtn.style.color="inherit";switchBtn.style.cursor="pointer";switchBtn.style.fontSize="10px";switchBtn.setAttribute("data-translate","switchTo");const deleteBtn=document.createElement("button");deleteBtn.textContent=t("delete");deleteBtn.style.padding="3px 6px";deleteBtn.style.borderRadius="4px";deleteBtn.style.border="1px solid #666";deleteBtn.style.background="rgba(200, 50, 50, 0.1)";deleteBtn.style.color="inherit";deleteBtn.style.cursor="pointer";deleteBtn.style.fontSize="10px";deleteBtn.setAttribute("data-translate","delete");switchBtn.addEventListener("click",()=>{localStorage.userToken=token.value;sessionSecret=token.value;showNotification(t("tokenSwitched"),"success");setTimeout(()=>location.reload(),500)});deleteBtn.addEventListener("click",()=>{sessionTokens.splice(index,1);saveSessionTokens();updateTokenList();showNotification(t("tokenDeleted"),"info")});tokenActions.appendChild(switchBtn);tokenActions.appendChild(deleteBtn);tokenDiv.appendChild(tokenInfo);tokenDiv.appendChild(tokenActions);tokenList.appendChild(tokenDiv)})}
addTokenBtn.addEventListener("click",()=>{const tokenName=tokenNameInput.value.trim();const currentToken=localStorage.userToken;if(!currentToken){showNotification("No current token available","error");return}
if(!tokenName){showNotification("Please enter a token name","error");return}
const exists=sessionTokens.some(t=>t.value===currentToken);if(exists){showNotification("Token already saved","error");return}
sessionTokens.push({name:tokenName,value:currentToken,date:new Date().toISOString(),type:"current"});saveSessionTokens();updateTokenList();tokenNameInput.value="";showNotification(t("tokenAdded"),"success")});addCustomTokenBtn.addEventListener("click",()=>{const tokenName=customTokenNameInput.value.trim();const tokenValue=customTokenValueInput.value.trim();if(!tokenName){showNotification("Please enter a token name","error");return}
if(!tokenValue){showNotification("Please enter a token value","error");return}
const exists=sessionTokens.some(t=>t.value===tokenValue);if(exists){showNotification("Token already saved","error");return}
sessionTokens.push({name:tokenName,value:tokenValue,date:new Date().toISOString(),type:"custom"});saveSessionTokens();updateTokenList();customTokenNameInput.value="";customTokenValueInput.value="";showNotification(t("tokenAdded"),"success")});btn.addEventListener("click",()=>{modal.style.display="flex";setTimeout(()=>{modal.style.opacity="1";box.style.transform="scale(1)"},20);updateTokenList()});closeBtn.addEventListener("click",()=>{modal.style.opacity="0";box.style.transform="scale(0.95)";setTimeout(()=>modal.style.display="none",250)});modal.addEventListener("click",e=>{if(e.target===modal){modal.style.opacity="0";box.style.transform="scale(0.95)";setTimeout(()=>modal.style.display="none",250)}});modInput.addEventListener("change",()=>{modList.innerHTML="";if(modInput.files.length===0){const emptyMsg=document.createElement("div");emptyMsg.textContent=t("noModsSelected");emptyMsg.style.opacity="0.6";emptyMsg.style.textAlign="center";emptyMsg.style.padding="10px";modList.appendChild(emptyMsg);return}
for(let i=0;i<modInput.files.length;i++){const file=modInput.files[i];const div=document.createElement("div");div.style.display="flex";div.style.flexDirection="column";div.style.gap="2px";div.style.padding="6px 8px";div.style.borderRadius="4px";div.style.border="1px solid #666";div.style.background="rgba(100, 100, 100, 0.05)";const fileName=document.createElement("div");fileName.textContent=file.name;fileName.style.fontSize="12px";fileName.style.fontFamily="monospace";fileName.style.overflow="hidden";fileName.style.textOverflow="ellipsis";fileName.style.whiteSpace="nowrap";const sizeInfo=document.createElement("div");sizeInfo.textContent=`${t("size")}: ${(file.size / 1024 / 1024).toFixed(2)} MB`;sizeInfo.style.fontSize="10px";sizeInfo.style.opacity="0.7";div.appendChild(fileName);div.appendChild(sizeInfo);modList.appendChild(div)}});uploadBtn.addEventListener("click",()=>{if(modInput.files.length===0){const emptyMsg=document.createElement("div");emptyMsg.textContent=t("pleaseSelect");emptyMsg.style.color="#dc3545";emptyMsg.style.padding="6px";emptyMsg.style.textAlign="center";modList.appendChild(emptyMsg);setTimeout(()=>emptyMsg.remove(),3000);return}
for(let i=0;i<modInput.files.length;i++){const file=modInput.files[i];const div=modList.children[i];const status=document.createElement("div");status.textContent=t("uploading");status.style.fontSize="10px";status.style.color="#ffc107";status.style.marginTop="2px";div.appendChild(status);const progressContainer=document.createElement("div");progressContainer.style.height="3px";progressContainer.style.background="rgba(100, 100, 100, 0.2)";progressContainer.style.borderRadius="2px";progressContainer.style.marginTop="4px";progressContainer.style.overflow="hidden";const progressBar=document.createElement("div");progressBar.style.height="100%";progressBar.style.width="0%";progressBar.style.background="linear-gradient(90deg, #666, #888)";progressBar.style.transition="width 0.3s ease";progressBar.style.borderRadius="2px";progressContainer.appendChild(progressBar);div.appendChild(progressContainer);const formData=new FormData();formData.append("file",file);formData.append("size",file.size);formData.append("visitSecret",localStorage.getItem("vs0"));fetch("https://factorio.zone/api/mod/upload",{method:"POST",body:formData}).then(response=>{if(response.ok){progressBar.style.width="100%";status.textContent=t("uploaded");status.style.color="#28a745";div.style.borderColor="#28a745";div.style.background="rgba(40, 167, 69, 0.05)"}else{throw new Error("Upload failed")}}).catch(error=>{progressBar.style.width="0%";status.textContent=t("failed");status.style.color="#dc3545";div.style.borderColor="#dc3545";div.style.background="rgba(220, 53, 69, 0.05)"})}
uploadBtn.disabled=!0;uploadBtn.textContent=t("uploading");uploadBtn.style.opacity="0.6";setTimeout(()=>{uploadBtn.disabled=!1;uploadBtn.textContent=t("uploadSelected");uploadBtn.style.opacity="1"},5000)});applyTheme(localStorage.getItem("fz_theme")||"dark");setTimeout(()=>{updateTranslations();document.querySelectorAll("[data-translate-placeholder]").forEach(el=>{const key=el.getAttribute("data-translate-placeholder");el.placeholder=t(key)})},100)}
const wait=setInterval(()=>{if(document.querySelector(".fre-info.fre-bottom")&&document.querySelector(".control-container")&&document.querySelector(".input-area")){clearInterval(wait);createSettings();styleControlButtons();overwriteOutputLog();styleInputs();setupCommandHints()}},300)})()
